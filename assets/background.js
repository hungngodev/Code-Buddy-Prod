const l=e=>chrome.storage.sync.set(e),m=e=>{const a=window.monaco.editor.getEditors().find(t=>t.id===e.id);a!=null&&a.layout()},h=async()=>{const e=await chrome.cookies.get({name:"LEETCODE_SESSION",url:"https://leetcode.com/"});if(e==null)return{status:"UNAUTHENTICATED"};const o=e.value.split(".")[1],a=JSON.parse(atob(o));return{status:"AUTHENTICATED",user:{id:a.identity,username:a.username}}};chrome.runtime.onInstalled.addListener(e=>{e.reason===chrome.runtime.OnInstalledReason.INSTALL&&l({editorPreference:{width:300,isCollapsed:!1}})});const w=async()=>{const o=window.monaco.editor.getEditors().filter(a=>a.id!=="CodeBuddy").map(a=>a.getModel()).find(a=>a.getLanguageId()!=="plaintext");return{value:o.getValue(),language:o.getLanguageId()}},f=async e=>{window.monaco.editor.getEditors().filter(t=>t.id!=="CodeBuddy").map(t=>t.getModel()).find(t=>t.getLanguageId()!=="plaintext").setValue(e)},p=async(e,o,a)=>{await new Promise(n=>setTimeout(n,2e3));const t=window.monaco;if(t.editor.getModels().length===3)u({code:o,language:a,changes:{range:{startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1},rangeLength:0,text:o,rangeOffset:0,forceMoveMarkers:!1},changeUser:!0});else{const n=await t.editor.create(document.getElementById(e),{value:o,language:a,readOnly:!0});n.id="CodeBuddy"}},u=async e=>{const{code:o,language:a,changes:t,changeUser:n}=e,i=window.monaco,r=await i.editor.getEditors().find(c=>c.id==="CodeBuddy");if(await r.getModel().getLanguageId()!==a||n){await i.editor.setModelLanguage(r.getModel(),a),r.setValue(o);return}const d={identifier:{major:1,minor:1},range:new i.Range(t.range.startLineNumber,t.range.startColumn,t.range.endLineNumber,t.range.endColumn),text:t.text,forceMoveMarkers:!1};await r.updateOptions({readOnly:!1}),await r.executeEdits("apply changes",[d]),await r.updateOptions({readOnly:!0})},E=async()=>{const e=window.monaco;try{await e.editor.getEditors().find(o=>o.id==="CodeBuddy").dispose()}catch{}};chrome.webNavigation.onCompleted.addListener(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){setTimeout(()=>{chrome.scripting.executeScript({target:{tabId:e[0].id??0},func:()=>{window.monaco.editor.getEditors().filter(t=>t.id!=="CodeBuddy").map(t=>t.getModel()).find(t=>t.getLanguageId()!=="plaintext").onDidChangeContent(t=>{const n=document.getElementById("trackEditor");n!=null&&(n.textContent=JSON.stringify(t.changes[0]))})},world:"MAIN"})},2e3)})},{url:[{schemes:["http","https"]}]});const g={};let y=0;chrome.runtime.onMessage.addListener((e,o,a)=>{var t,n,i,r,s,d;switch(e.action){case"cookie":{h().then(c=>{a(c)});break}case"getValue":{chrome.scripting.executeScript({target:{tabId:((t=o.tab)==null?void 0:t.id)??0},func:w,world:"MAIN"}).then(c=>{a(c[0].result)});break}case"setValue":{chrome.scripting.executeScript({target:{tabId:((n=o.tab)==null?void 0:n.id)??0},func:f,args:[e.value],world:"MAIN"}).then(()=>{a()});break}case"createModel":{chrome.scripting.executeScript({target:{tabId:((i=o.tab)==null?void 0:i.id)??0},func:p,args:[e.id,e.code,e.language],world:"MAIN"}).then(()=>{a()});break}case"setValueOtherEditor":{chrome.scripting.executeScript({target:{tabId:((r=o.tab)==null?void 0:r.id)??0},func:u,args:[{code:e.code,language:e.language,changes:e.changes,changeUser:e.changeUser}],world:"MAIN"}).then(()=>{a()});break}case"updateEditorLayout":{chrome.scripting.executeScript({target:{tabId:((s=o.tab)==null?void 0:s.id)??0},func:m,args:[{id:e.monacoEditorId}],world:"MAIN"});break}case"cleanEditor":{chrome.scripting.executeScript({target:{tabId:((d=o.tab)==null?void 0:d.id)??0},func:E,world:"MAIN"});break}case"test":{g[y++]="a",a({a:g});break}}return!0});
